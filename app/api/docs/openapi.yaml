openapi: 3.0.3
info:
  title: ClockWise API
  description: |
    ClockWise is a workforce management and scheduling platform for organizations.
    
    ## Getting Started
    
    ### Base URL
    ```
    http://localhost:8080
    ```
    
    ### Authentication
    Most endpoints require JWT Bearer token authentication. Here's how to get started:
    
    1. **Register an organization** (or use existing credentials)
    2. **Login** to get a JWT token
    3. **Include the token** in all subsequent requests
    
    ### Authentication Flow Example
    
    #### Step 1: Login
    ```http
    POST /api/login
    Content-Type: application/json
    
    {
      "email": "admin@acme.com",
      "password": "securePassword123"
    }
    ```
    
    #### Step 2: Use the token
    ```http
    GET /api/550e8400-e29b-41d4-a716-446655440000/staffing
    Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    Accept: application/json
    ```
    
    ### Common Headers
    
    | Header | Value | When to Use |
    |--------|-------|-------------|
    | `Content-Type` | `application/json` | All POST/PUT requests with JSON body |
    | `Content-Type` | `multipart/form-data` | File upload requests |
    | `Accept` | `application/json` | All requests |
    | `Authorization` | `Bearer <token>` | All authenticated requests |
    
    ### Error Handling
    All errors return a JSON object with an `error` field:
    ```json
    {
      "error": "Error message describing what went wrong"
    }
    ```
    
    ### Common HTTP Status Codes
    | Code | Description |
    |------|-------------|
    | 200 | Success |
    | 201 | Created successfully |
    | 400 | Bad request (invalid input) |
    | 401 | Unauthorized (missing or invalid token) |
    | 403 | Forbidden (insufficient permissions) |
    | 404 | Resource not found |
    | 500 | Internal server error |
    
    ## Roles
    - **admin**: Full access to all organization features
    - **manager**: Can manage employees, approve requests, but cannot layoff admins
    - **staff/employee**: Limited access, can view own data and submit requests
    
    ## Token Expiration
    - Access tokens expire after **15 minutes**
    - Use the `/api/auth/refresh` endpoint to get a new token
    - Refresh tokens are valid for **7 days**
  version: 1.0.0
  contact:
    name: ClockWise API Support
    email: ziadeliwa@aucegypt.edu
  license:
    name: MIT License
    url: https://opensource.org/license/mit
  termsOfService: http://swagger.io/terms/

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Health
    description: API health check endpoints
  - name: Authentication
    description: User authentication and session management
  - name: Organizations
    description: Organization registration and management
  - name: Staffing
    description: Employee management and bulk operations
  - name: Employees
    description: Individual employee operations
  - name: Roles
    description: Organization role management
  - name: Dashboard
    description: Dashboard and analytics
  - name: Schedule
    description: Schedule management
  - name: Insights
    description: Organization insights and analytics
  - name: Preferences
    description: Employee preferences
  - name: Rules
    description: Organization rules and policies

x-request-headers:
  description: |
    ## Common Request Headers
    
    ### For all requests:
    ```
    Content-Type: application/json
    Accept: application/json
    ```
    
    ### For authenticated requests (add to above):
    ```
    Authorization: Bearer <your-jwt-token>
    ```
    
    ### For file uploads:
    ```
    Content-Type: multipart/form-data
    Authorization: Bearer <your-jwt-token>
    ```

security:
  - BearerAuth: []

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns the health status of the API and database connection
      security: []
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: |
        Authenticates a user and returns a JWT token.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        ```
        
        ## Request Body Example
        ```json
        {
          "email": "admin@acme.com",
          "password": "securePassword123"
        }
        ```
        
        ## Response Example (Success)
        ```json
        {
          "expires_in": "2026-02-05T15:30:00Z",
          "access_token": "eyJhbGciOiJIUzI1Ni...",
          "refresh_token": "eyJhbGciOiJIUzI1N9..."
          "token_type": "Bearer",
        }
        ```
        
        ## Response Example (Error)
        ```json
        {
          "code": 401,
          "message": "incorrect Username or Password"
        }
        ```
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: "admin@acme.com"
              password: "securePassword123"
      responses:
        '200':
          description: Login successful
          headers:
            Content-Type:
              schema:
                type: string
                example: application/json
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              example:
                expires_in: "2026-02-05T15:30:00Z"
                access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                refresh_token: "eyJhbGciOiJIUzI1N9..."
                token_type: "Bearer"
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: 401
                message: "incorrect Username or Password"

  /api/register:
    post:
      tags:
        - Organizations
      summary: Register a new organization
      description: |
        Creates a new organization along with an admin user account.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        ```
        
        ## Request Body Example
        ```json
        {
          "org_name": "Acme Corporation",
          "org_address": "123 Main St, City, State 12345",
          "admin_full_name": "John Doe",
          "admin_email": "admin@acme.com",
          "admin_password": "securePassword123",
          "hex1": "FF5733",
          "hex2": "33FF57",
          "hex3": "3357FF"
        }
        ```
        
        ## Response Example (Success - 201)
        ```json
        {
          "message": "Organization registered successfully",
          "org_id": "550e8400-e29b-41d4-a716-446655440000",
          "user_id": "550e8400-e29b-41d4-a716-446655440001"
        }
        ```
        
        ## Response Example (Error - 400)
        ```json
        {
          "error": "Key: 'RegisterOrgRequest.AdminEmail' Error:Field validation for 'AdminEmail' failed on the 'email' tag"
        }
        ```
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterOrgRequest'
            example:
              org_name: "Acme Corporation"
              org_address: "123 Main St, City, State 12345"
              admin_full_name: "John Doe"
              admin_email: "admin@acme.com"
              admin_password: "securePassword123"
              hex1: "FF5733"
              hex2: "33FF57"
              hex3: "3357FF"
      responses:
        '201':
          description: Organization registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterOrgResponse'
              example:
                message: "Organization registered successfully"
                org_id: "550e8400-e29b-41d4-a716-446655440000"
                user_id: "550e8400-e29b-41d4-a716-446655440001"
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Key: 'RegisterOrgRequest.AdminEmail' Error:Field validation for 'AdminEmail' failed on the 'email' tag"
        '500':
          description: Registration failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Registration failed: organization name already exists"

  /api/auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh JWT token
      description: |
        Refreshes an existing valid JWT token before it expires.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        Authorization: Bearer <your-current-jwt-token>
        ```
        
        ## Request Body
        ```json
        {
          "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        }
        
        ## Response Example (Success)
        ```json
        {
          "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.newTokenPayload.signature",
          "expires_in": "2026-02-05T16:00:00Z",
          "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.newTokenPayload.signature",
          "token_type": "Bearer"
        }
        ```
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              example:
                access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                expires_in: "2026-02-05T16:00:00Z"
                refresh_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                token_type: "Bearer"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: 401
                message: "Token is expired"

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: |
        Invalidates the current JWT token.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Response Example (Success)
        ```json
        {
          "message": "Successfully logged out"
        }
        ```
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Successfully logged out
              example:
                message: "Successfully logged out"

  /api/auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: |
        Returns the currently authenticated user's information and JWT claims.
        
        ## Request Headers
        ```
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Response Example (Success)
        ```json
        {
          "user": {
            "id": "550e8400-e29b-41d4-a716-446655440001",
            "full_name": "John Doe",
            "email": "admin@acme.com",
            "user_role": "admin",
            "organization_id": "550e8400-e29b-41d4-a716-446655440000"
          },
          "claims": {
            "id": "550e8400-e29b-41d4-a716-446655440001",
            "full_name": "John Doe",
            "email": "admin@acme.com",
            "user_role": "admin",
            "organization_id": "550e8400-e29b-41d4-a716-446655440000",
            "exp": 1738773000,
            "orig_iat": 1738772100
          }
        }
        ```
      responses:
        '200':
          description: Current user information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrentUserResponse'
              example:
                user:
                  id: "550e8400-e29b-41d4-a716-446655440001"
                  full_name: "John Doe"
                  email: "admin@acme.com"
                  user_role: "admin"
                  organization_id: "550e8400-e29b-41d4-a716-446655440000"
                claims:
                  id: "550e8400-e29b-41d4-a716-446655440001"
                  full_name: "John Doe"
                  email: "admin@acme.com"
                  user_role: "admin"
                  organization_id: "550e8400-e29b-41d4-a716-446655440000"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: 401
                message: "cookie token is empty"

  /api/{org}:
    get:
      tags:
        - Organizations
      summary: Get organization details
      description: Returns details of the specified organization
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: Organization details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/request:
    post:
      tags:
        - Employees
      summary: Submit a call-off request
      description: An employee can request a call-off from their organization
      parameters:
        - $ref: '#/components/parameters/OrgId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CallOffRequest'
      responses:
        '201':
          description: Request submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/roles:
    get:
      tags:
        - Roles
      summary: Get all roles
      description: |
        Returns all roles defined for the organization.
        
        ## Request Headers
        ```
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Response Example (Success)
        ```json
        [
          {
            "organization_id": "550e8400-e29b-41d4-a716-446655440000",
            "role": "admin",
            "min_needed_per_shift": 0,
            "items_per_role_per_hour": null,
            "need_for_demand": false
          },
          {
            "organization_id": "550e8400-e29b-41d4-a716-446655440000",
            "role": "manager",
            "min_needed_per_shift": 1,
            "items_per_role_per_hour": null,
            "need_for_demand": false
          },
          {
            "organization_id": "550e8400-e29b-41d4-a716-446655440000",
            "role": "cashier",
            "min_needed_per_shift": 2,
            "items_per_role_per_hour": 15,
            "need_for_demand": true
          }
        ]
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: List of roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
              example:
                - organization_id: "550e8400-e29b-41d4-a716-446655440000"
                  role: "admin"
                  min_needed_per_shift: 0
                  items_per_role_per_hour: null
                  need_for_demand: false
                - organization_id: "550e8400-e29b-41d4-a716-446655440000"
                  role: "manager"
                  min_needed_per_shift: 1
                  items_per_role_per_hour: null
                  need_for_demand: false
                - organization_id: "550e8400-e29b-41d4-a716-446655440000"
                  role: "cashier"
                  min_needed_per_shift: 2
                  items_per_role_per_hour: 15
                  need_for_demand: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
    post:
      tags:
        - Roles
      summary: Create a new role
      description: |
        Creates a new role in the organization.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Request Body Example
        ```json
        {
          "role": "cashier",
          "min_needed_per_shift": 2,
          "items_per_role_per_hour": 15,
          "need_for_demand": true
        }
        ```
        
        ## Response Example (Success - 201)
        ```json
        {
          "organization_id": "550e8400-e29b-41d4-a716-446655440000",
          "role": "cashier",
          "min_needed_per_shift": 2,
          "items_per_role_per_hour": 15,
          "need_for_demand": true
        }
        ```
        
        ## Notes
        - If `need_for_demand` is true, `items_per_role_per_hour` is required
        - If `need_for_demand` is false, `items_per_role_per_hour` should be null
      parameters:
        - $ref: '#/components/parameters/OrgId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRoleRequest'
            example:
              role: "cashier"
              min_needed_per_shift: 2
              items_per_role_per_hour: 15
              need_for_demand: true
      responses:
        '201':
          description: Role created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
              example:
                organization_id: "550e8400-e29b-41d4-a716-446655440000"
                role: "cashier"
                min_needed_per_shift: 2
                items_per_role_per_hour: 15
                need_for_demand: true
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "items_per_role_per_hour is required when need_for_demand is true"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"

  /api/{org}/roles/{role}:
    get:
      tags:
        - Roles
      summary: Get role details
      description: Returns details of a specific role
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/RoleName'
      responses:
        '200':
          description: Role details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '404':
          description: Role not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      tags:
        - Roles
      summary: Update a role
      description: Updates an existing role
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/RoleName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleRequest'
      responses:
        '200':
          description: Role updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Role not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - Roles
      summary: Delete a role
      description: Deletes a role from the organization
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/RoleName'
      responses:
        '200':
          description: Role deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Role deleted successfully
        '404':
          description: Role not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/dashboard:
    get:
      tags:
        - Dashboard
      summary: Get dashboard data
      description: Returns dashboard data based on the current user's role
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/dashboard/schedule:
    get:
      tags:
        - Schedule
      summary: Get schedule
      description: Returns the organization's schedule
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: Schedule data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      tags:
        - Schedule
      summary: Update schedule
      description: Updates the organization's schedule
      parameters:
        - $ref: '#/components/parameters/OrgId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScheduleRequest'
      responses:
        '200':
          description: Schedule updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/dashboard/schedule/refresh:
    post:
      tags:
        - Schedule
      summary: Refresh schedule
      description: Regenerates the organization's schedule
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: Schedule refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleResponse'
        '500':
          description: Failed to refresh schedule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/insights:
    get:
      tags:
        - Insights
      summary: Get organization insights
      description: Returns analytics and insights for the organization
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: Organization insights
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InsightsResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/staffing:
    get:
      tags:
        - Staffing
      summary: Get staffing summary
      description: |
        Returns staffing overview including total employees and breakdown by role.
        
        ## Request Headers
        ```
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Response Example (Success)
        ```json
        {
          "total_employees": 25,
          "by_role": {
            "admin": 1,
            "manager": 3,
            "staff": 21
          },
          "employees": [
            {
              "id": "550e8400-e29b-41d4-a716-446655440001",
              "full_name": "John Doe",
              "email": "john@acme.com",
              "user_role": "admin",
              "salary_per_hour": null,
              "organization_id": "550e8400-e29b-41d4-a716-446655440000",
              "created_at": "2026-01-15T10:30:00Z",
              "updated_at": "2026-01-15T10:30:00Z"
            },
            {
              "id": "550e8400-e29b-41d4-a716-446655440002",
              "full_name": "Jane Smith",
              "email": "jane@acme.com",
              "user_role": "manager",
              "salary_per_hour": 35.00,
              "organization_id": "550e8400-e29b-41d4-a716-446655440000",
              "created_at": "2026-01-16T09:00:00Z",
              "updated_at": "2026-01-16T09:00:00Z"
            }
          ]
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: Staffing summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StaffingSummary'
              example:
                total_employees: 25
                by_role:
                  admin: 1
                  manager: 3
                  staff: 21
                employees:
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    full_name: "John Doe"
                    email: "john@acme.com"
                    user_role: "admin"
                    salary_per_hour: null
                    organization_id: "550e8400-e29b-41d4-a716-446655440000"
                    created_at: "2026-01-15T10:30:00Z"
                    updated_at: "2026-01-15T10:30:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '500':
          description: Failed to retrieve employees
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Failed to retrieve employees"
    post:
      tags:
        - Staffing
      summary: Create a new employee
      description: |
        Delegates/creates a new user in the organization. Only admins and managers can perform this action.
        A welcome email with temporary password is sent to the new employee.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Request Body Example
        ```json
        {
          "full_name": "Jane Smith",
          "email": "jane.smith@acme.com",
          "role": "staff",
          "salary_per_hour": 20.50
        }
        ```
        
        ## Response Example (Success - 201)
        ```json
        {
          "message": "User delegated successfully. Email sent.",
          "user_id": "550e8400-e29b-41d4-a716-446655440005"
        }
        ```
        
        ## Response Example (Error - 403)
        ```json
        {
          "error": "Staff cannot delegate users"
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DelegateUserRequest'
            example:
              full_name: "Jane Smith"
              email: "jane.smith@acme.com"
              role: "staff"
              salary_per_hour: 20.50
      responses:
        '201':
          description: User delegated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DelegateUserResponse'
              example:
                message: "User delegated successfully. Email sent."
                user_id: "550e8400-e29b-41d4-a716-446655440005"
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Key: 'DelegateUserRequest.Email' Error:Field validation for 'Email' failed on the 'email' tag"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '403':
          description: Staff cannot delegate users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Staff cannot delegate users"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Database error: duplicate key value violates unique constraint"

  /api/{org}/staffing/upload:
    post:
      tags:
        - Staffing
      summary: Bulk upload employees via CSV
      description: |
        Upload a CSV file to create multiple employees at once.
        
        ## Request Headers
        ```
        Content-Type: multipart/form-data
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## CSV File Format
        Required headers: `full_name`, `email`, `role`, `salary`
        
        Example CSV content:
        ```csv
        full_name,email,role,salary
        John Smith,john.smith@acme.com,staff,18.50
        Jane Doe,jane.doe@acme.com,manager,35.00
        Bob Wilson,bob.wilson@acme.com,employee,15.00
        ```
        
        Valid roles: `manager`, `staff`, `employee`
        
        ## Form Data
        - **file**: The CSV file (required)
        
        ## Response Example (Success - 200)
        ```json
        {
          "message": "Bulk upload completed",
          "created_count": 2,
          "created": [
            "john.smith@acme.com",
            "jane.doe@acme.com"
          ],
          "failed_count": 1,
          "failed": [
            {
              "email": "bob.wilson@acme.com",
              "error": "duplicate key value violates unique constraint"
            }
          ]
        }
        ```
        
        ## Response Example (Error - 400)
        ```json
        {
          "error": "Missing required header: salary"
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: CSV file with employee data
      responses:
        '200':
          description: Bulk upload completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkUploadResponse'
              example:
                message: "Bulk upload completed"
                created_count: 2
                created:
                  - "john.smith@acme.com"
                  - "jane.doe@acme.com"
                failed_count: 1
                failed:
                  - email: "bob.wilson@acme.com"
                    error: "duplicate key value violates unique constraint"
        '400':
          description: No file uploaded or invalid CSV format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Missing required header: salary"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '403':
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "You don't have permission to upload employees"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Failed to retrieve organization"

  /api/{org}/staffing/employees:
    get:
      tags:
        - Staffing
      summary: Get all employees
      description: |
        Returns a list of all employees in the organization.
        
        ## Request Headers
        ```
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Response Example (Success)
        ```json
        {
          "employees": [
            {
              "id": "550e8400-e29b-41d4-a716-446655440001",
              "full_name": "John Doe",
              "email": "john@acme.com",
              "user_role": "admin",
              "salary_per_hour": null,
              "organization_id": "550e8400-e29b-41d4-a716-446655440000",
              "created_at": "2026-01-15T10:30:00Z",
              "updated_at": "2026-01-15T10:30:00Z"
            },
            {
              "id": "550e8400-e29b-41d4-a716-446655440002",
              "full_name": "Jane Smith",
              "email": "jane@acme.com",
              "user_role": "staff",
              "salary_per_hour": 20.50,
              "organization_id": "550e8400-e29b-41d4-a716-446655440000",
              "created_at": "2026-01-16T09:00:00Z",
              "updated_at": "2026-01-16T09:00:00Z"
            }
          ],
          "total": 2
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: List of employees
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeesListResponse'
              example:
                employees:
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    full_name: "John Doe"
                    email: "john@acme.com"
                    user_role: "admin"
                    salary_per_hour: null
                    organization_id: "550e8400-e29b-41d4-a716-446655440000"
                    created_at: "2026-01-15T10:30:00Z"
                    updated_at: "2026-01-15T10:30:00Z"
                  - id: "550e8400-e29b-41d4-a716-446655440002"
                    full_name: "Jane Smith"
                    email: "jane@acme.com"
                    user_role: "staff"
                    salary_per_hour: 20.50
                    organization_id: "550e8400-e29b-41d4-a716-446655440000"
                    created_at: "2026-01-16T09:00:00Z"
                    updated_at: "2026-01-16T09:00:00Z"
                total: 2
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '500':
          description: Failed to retrieve employees
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Failed to retrieve employees"

  /api/{org}/staffing/employees/{id}:
    get:
      tags:
        - Employees
      summary: Get employee details
      description: |
        Returns detailed information about a specific employee.
        
        ## Request Headers
        ```
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## URL Parameters
        - **org**: Organization UUID (e.g., `550e8400-e29b-41d4-a716-446655440000`)
        - **id**: Employee UUID (e.g., `550e8400-e29b-41d4-a716-446655440001`)
        
        ## Response Example (Success)
        ```json
        {
          "id": "550e8400-e29b-41d4-a716-446655440001",
          "full_name": "John Doe",
          "email": "john@acme.com",
          "user_role": "manager",
          "salary_per_hour": 35.00,
          "organization_id": "550e8400-e29b-41d4-a716-446655440000",
          "created_at": "2026-01-15T10:30:00Z",
          "updated_at": "2026-01-15T10:30:00Z"
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/EmployeeId'
      responses:
        '200':
          description: Employee details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
              example:
                id: "550e8400-e29b-41d4-a716-446655440001"
                full_name: "John Doe"
                email: "john@acme.com"
                user_role: "manager"
                salary_per_hour: 35.00
                organization_id: "550e8400-e29b-41d4-a716-446655440000"
                created_at: "2026-01-15T10:30:00Z"
                updated_at: "2026-01-15T10:30:00Z"
        '400':
          description: Invalid employee ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid employee ID"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Access denied"
        '404':
          description: Employee not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Employee not found"

  /api/{org}/staffing/employees/{id}/layoff:
    delete:
      tags:
        - Employees
      summary: Layoff an employee
      description: |
        Marks an employee as laid off. Only admins and managers can perform this action.
        - Managers cannot layoff admins
        - Users cannot layoff themselves
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## URL Parameters
        - **org**: Organization UUID
        - **id**: Employee UUID to layoff
        
        ## Request Body Example (Optional)
        ```json
        {
          "reason": "Position eliminated due to restructuring"
        }
        ```
        
        ## Response Example (Success)
        ```json
        {
          "message": "Employee laid off successfully",
          "employee_id": "550e8400-e29b-41d4-a716-446655440005"
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/EmployeeId'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LayoffRequest'
            example:
              reason: "Position eliminated due to restructuring"
      responses:
        '200':
          description: Employee laid off successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LayoffResponse'
              example:
                message: "Employee laid off successfully"
                employee_id: "550e8400-e29b-41d4-a716-446655440005"
        '400':
          description: Invalid employee ID or cannot layoff yourself
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Cannot layoff yourself"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '403':
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Managers cannot layoff admins"
        '404':
          description: Employee not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Employee not found"
        '500':
          description: Failed to layoff employee
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Failed to layoff employee"

  /api/{org}/staffing/employees/{id}/schedule:
    get:
      tags:
        - Employees
      summary: Get employee schedule
      description: Returns the schedule for a specific employee
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/EmployeeId'
      responses:
        '200':
          description: Employee schedule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeScheduleResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Employee not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      tags:
        - Employees
      summary: Update employee schedule
      description: Updates the schedule for a specific employee
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/EmployeeId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEmployeeScheduleRequest'
      responses:
        '200':
          description: Schedule updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeScheduleResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/staffing/employees/{id}/requests:
    get:
      tags:
        - Employees
      summary: Get employee requests
      description: |
        Returns all requests (time-off, call-off, etc.) for a specific employee.
        Employees can only view their own requests unless they are admin/manager.
        
        ## Request Headers
        ```
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Response Example (Success)
        ```json
        {
          "requests": [
            {
              "request_id": "550e8400-e29b-41d4-a716-446655440010",
              "employee_id": "550e8400-e29b-41d4-a716-446655440001",
              "type": "call-off",
              "message": "I need to take Friday off for a doctor's appointment",
              "submitted_at": "2026-02-01T08:30:00Z",
              "updated_at": "2026-02-01T08:30:00Z",
              "status": "in queue"
            },
            {
              "request_id": "550e8400-e29b-41d4-a716-446655440011",
              "employee_id": "550e8400-e29b-41d4-a716-446655440001",
              "type": "time-off",
              "message": "Vacation request for next week",
              "submitted_at": "2026-01-28T10:00:00Z",
              "updated_at": "2026-01-29T14:00:00Z",
              "status": "accepted"
            }
          ],
          "total": 2
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/EmployeeId'
      responses:
        '200':
          description: List of employee requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeRequestsResponse'
              example:
                requests:
                  - request_id: "550e8400-e29b-41d4-a716-446655440010"
                    employee_id: "550e8400-e29b-41d4-a716-446655440001"
                    type: "call-off"
                    message: "I need to take Friday off for a doctor's appointment"
                    submitted_at: "2026-02-01T08:30:00Z"
                    updated_at: "2026-02-01T08:30:00Z"
                    status: "in queue"
                  - request_id: "550e8400-e29b-41d4-a716-446655440011"
                    employee_id: "550e8400-e29b-41d4-a716-446655440001"
                    type: "time-off"
                    message: "Vacation request for next week"
                    submitted_at: "2026-01-28T10:00:00Z"
                    updated_at: "2026-01-29T14:00:00Z"
                    status: "accepted"
                total: 2
        '400':
          description: Invalid employee ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid employee ID"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Access denied"
        '404':
          description: Employee not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Employee not found"
        '500':
          description: Failed to retrieve requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Failed to retrieve requests"

  /api/{org}/staffing/employees/{id}/requests/approve:
    post:
      tags:
        - Employees
      summary: Approve an employee request
      description: |
        Approves a pending employee request. Only admins and managers can approve requests.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Request Body Example
        ```json
        {
          "request_id": "550e8400-e29b-41d4-a716-446655440010"
        }
        ```
        
        ## Response Example (Success)
        ```json
        {
          "message": "Request approved successfully",
          "request_id": "550e8400-e29b-41d4-a716-446655440010"
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/EmployeeId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestActionBody'
            example:
              request_id: "550e8400-e29b-41d4-a716-446655440010"
      responses:
        '200':
          description: Request approved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestActionResponse'
              example:
                message: "Request approved successfully"
                request_id: "550e8400-e29b-41d4-a716-446655440010"
        '400':
          description: Invalid request body or request ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid request ID"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '403':
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "You don't have permission to approve requests"
        '404':
          description: Request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Request not found"
        '500':
          description: Failed to approve request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Failed to approve request"

  /api/{org}/staffing/employees/{id}/requests/decline:
    post:
      tags:
        - Employees
      summary: Decline an employee request
      description: |
        Declines a pending employee request. Only admins and managers can decline requests.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Request Body Example
        ```json
        {
          "request_id": "550e8400-e29b-41d4-a716-446655440010"
        }
        ```
        
        ## Response Example (Success)
        ```json
        {
          "message": "Request declined successfully",
          "request_id": "550e8400-e29b-41d4-a716-446655440010"
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
        - $ref: '#/components/parameters/EmployeeId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestActionBody'
            example:
              request_id: "550e8400-e29b-41d4-a716-446655440010"
      responses:
        '200':
          description: Request declined successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestActionResponse'
              example:
                message: "Request declined successfully"
                request_id: "550e8400-e29b-41d4-a716-446655440010"
        '400':
          description: Invalid request body or request ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid request ID"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '403':
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "You don't have permission to decline requests"
        '404':
          description: Request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Request not found"
        '500':
          description: Failed to decline request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Failed to decline request"

  /api/{org}/preferences:
    get:
      tags:
        - Preferences
      summary: Get employee preferences
      description: Returns the current employee's preferences
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: Employee preferences
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PreferencesResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
        - Preferences
      summary: Update employee preferences
      description: Updates the current employee's preferences
      parameters:
        - $ref: '#/components/parameters/OrgId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePreferencesRequest'
      responses:
        '200':
          description: Preferences updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PreferencesResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/{org}/rules:
    get:
      tags:
        - Rules
      summary: Get organization rules
      description: |
        Returns all rules and policies for the organization.
        
        ## Request Headers
        ```
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Response Example (Success)
        ```json
        {
          "organization_id": "550e8400-e29b-41d4-a716-446655440000",
          "shift_max_hours": 10,
          "shift_min_hours": 4,
          "max_weekly_hours": 40,
          "min_weekly_hours": 20
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
      responses:
        '200':
          description: Organization rules
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RulesResponse'
              example:
                organization_id: "550e8400-e29b-41d4-a716-446655440000"
                shift_max_hours: 10
                shift_min_hours: 4
                max_weekly_hours: 40
                min_weekly_hours: 20
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
    post:
      tags:
        - Rules
      summary: Update organization rules
      description: |
        Updates the organization's rules and policies. Only admins can update rules.
        
        ## Request Headers
        ```
        Content-Type: application/json
        Accept: application/json
        Authorization: Bearer <your-jwt-token>
        ```
        
        ## Request Body Example
        ```json
        {
          "shift_max_hours": 10,
          "shift_min_hours": 4,
          "max_weekly_hours": 40,
          "min_weekly_hours": 20
        }
        ```
        
        ## Response Example (Success)
        ```json
        {
          "organization_id": "550e8400-e29b-41d4-a716-446655440000",
          "shift_max_hours": 10,
          "shift_min_hours": 4,
          "max_weekly_hours": 40,
          "min_weekly_hours": 20
        }
        ```
      parameters:
        - $ref: '#/components/parameters/OrgId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRulesRequest'
            example:
              shift_max_hours: 10
              shift_min_hours: 4
              max_weekly_hours: 40
              min_weekly_hours: 20
      responses:
        '200':
          description: Rules updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RulesResponse'
              example:
                organization_id: "550e8400-e29b-41d4-a716-446655440000"
                shift_max_hours: 10
                shift_min_hours: 4
                max_weekly_hours: 40
                min_weekly_hours: 20
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "shift_min_hours cannot be greater than shift_max_hours"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
        '403':
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Only admins can update organization rules"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from the login endpoint

  parameters:
    OrgId:
      name: org
      in: path
      required: true
      description: Organization UUID
      schema:
        type: string
        format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    
    EmployeeId:
      name: id
      in: path
      required: true
      description: Employee UUID
      schema:
        type: string
        format: uuid
        example: "550e8400-e29b-41d4-a716-446655440001"
    
    RoleName:
      name: role
      in: path
      required: true
      description: Role name
      schema:
        type: string
        example: "manager"

  schemas:
    # Error Response
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          example: "Error message"

    # Health
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "up"
        message:
          type: string
          example: "It's healthy"
        open_connections:
          type: string
          example: "5"
        in_use:
          type: string
          example: "2"
        idle:
          type: string
          example: "3"

    # Authentication
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "admin@example.com"
        password:
          type: string
          format: password
          example: "password123"

    LoginResponse:
      type: object
      properties:
        code:
          type: integer
          example: 200
        expire:
          type: string
          format: date-time
          example: "2026-02-05T15:30:00Z"
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    CurrentUserResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        claims:
          type: object
          properties:
            id:
              type: string
              format: uuid
            full_name:
              type: string
            email:
              type: string
              format: email
            user_role:
              type: string
            organization_id:
              type: string
              format: uuid

    # Organization
    RegisterOrgRequest:
      type: object
      required:
        - org_name
        - admin_full_name
        - admin_email
        - admin_password
        - hex1
        - hex2
        - hex3
      properties:
        org_name:
          type: string
          description: Organization name
          example: "Acme Corporation"
        org_address:
          type: string
          description: Organization address (optional)
          example: "123 Main St, City, State"
        admin_full_name:
          type: string
          description: Admin user's full name
          example: "John Doe"
        admin_email:
          type: string
          format: email
          description: Admin user's email
          example: "admin@acme.com"
        admin_password:
          type: string
          format: password
          minLength: 8
          description: Admin password (minimum 8 characters)
          example: "securePassword123"
        hex1:
          type: string
          minLength: 6
          maxLength: 6
          description: Primary brand color (6-character hex code without #)
          example: "FF5733"
        hex2:
          type: string
          minLength: 6
          maxLength: 6
          description: Secondary brand color (6-character hex code without #)
          example: "33FF57"
        hex3:
          type: string
          minLength: 6
          maxLength: 6
          description: Tertiary brand color (6-character hex code without #)
          example: "3357FF"

    RegisterOrgResponse:
      type: object
      properties:
        message:
          type: string
          example: "Organization registered successfully"
        org_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        user_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"

    Organization:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        address:
          type: string
        email:
          type: string
          format: email
        hex1:
          type: string
        hex2:
          type: string
        hex3:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # User
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        full_name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        user_role:
          type: string
          enum: [admin, manager, staff, employee]
          example: "manager"
        salary_per_hour:
          type: number
          format: float
          nullable: true
          example: 25.50
        organization_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Staffing
    DelegateUserRequest:
      type: object
      required:
        - full_name
        - email
        - role
        - salary_per_hour
      properties:
        full_name:
          type: string
          description: Employee's full name
          example: "Jane Smith"
        email:
          type: string
          format: email
          description: Employee's email
          example: "jane@example.com"
        role:
          type: string
          enum: [manager, staff]
          description: Employee's role
          example: "staff"
        salary_per_hour:
          type: number
          format: float
          description: Hourly salary
          example: 20.00

    DelegateUserResponse:
      type: object
      properties:
        message:
          type: string
          example: "User delegated successfully. Email sent."
        user_id:
          type: string
          format: uuid

    StaffingSummary:
      type: object
      properties:
        total_employees:
          type: integer
          example: 25
        by_role:
          type: object
          additionalProperties:
            type: integer
          example:
            admin: 1
            manager: 3
            staff: 21
        employees:
          type: array
          items:
            $ref: '#/components/schemas/User'

    EmployeesListResponse:
      type: object
      properties:
        employees:
          type: array
          items:
            $ref: '#/components/schemas/User'
        total:
          type: integer
          example: 25

    BulkUploadResponse:
      type: object
      properties:
        message:
          type: string
          example: "Bulk upload completed"
        created_count:
          type: integer
          example: 8
        created:
          type: array
          items:
            type: string
            format: email
          example: ["user1@example.com", "user2@example.com"]
        failed_count:
          type: integer
          example: 2
        failed:
          type: array
          items:
            type: object
            properties:
              email:
                type: string
                format: email
              error:
                type: string

    # Layoff
    LayoffRequest:
      type: object
      properties:
        reason:
          type: string
          description: Reason for layoff (optional)
          example: "Position eliminated due to restructuring"

    LayoffResponse:
      type: object
      properties:
        message:
          type: string
          example: "Employee laid off successfully"
        employee_id:
          type: string
          format: uuid

    # Requests
    Request:
      type: object
      properties:
        request_id:
          type: string
          format: uuid
        employee_id:
          type: string
          format: uuid
        type:
          type: string
          example: "call-off"
        message:
          type: string
          example: "I need to take the day off for personal reasons"
        submitted_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        status:
          type: string
          enum: [in queue, accepted, declined]
          example: "in queue"

    CallOffRequest:
      type: object
      required:
        - type
        - message
      properties:
        type:
          type: string
          example: "call-off"
        message:
          type: string
          example: "I need to take the day off for personal reasons"

    RequestResponse:
      type: object
      properties:
        message:
          type: string
          example: "Request submitted successfully"
        request_id:
          type: string
          format: uuid

    EmployeeRequestsResponse:
      type: object
      properties:
        requests:
          type: array
          items:
            $ref: '#/components/schemas/Request'
        total:
          type: integer
          example: 5

    RequestActionBody:
      type: object
      required:
        - request_id
      properties:
        request_id:
          type: string
          format: uuid
          description: UUID of the request to approve/decline
          example: "550e8400-e29b-41d4-a716-446655440002"

    RequestActionResponse:
      type: object
      properties:
        message:
          type: string
          example: "Request approved successfully"
        request_id:
          type: string
          format: uuid

    # Roles
    Role:
      type: object
      properties:
        organization_id:
          type: string
          format: uuid
        role:
          type: string
          example: "cashier"
        min_needed_per_shift:
          type: integer
          example: 2
        items_per_role_per_hour:
          type: integer
          nullable: true
          example: 15
        need_for_demand:
          type: boolean
          example: true

    CreateRoleRequest:
      type: object
      required:
        - role
        - min_needed_per_shift
        - need_for_demand
      properties:
        role:
          type: string
          example: "cashier"
        min_needed_per_shift:
          type: integer
          minimum: 0
          example: 2
        items_per_role_per_hour:
          type: integer
          nullable: true
          minimum: 0
          description: Required if need_for_demand is true
          example: 15
        need_for_demand:
          type: boolean
          example: true

    UpdateRoleRequest:
      type: object
      properties:
        min_needed_per_shift:
          type: integer
          minimum: 0
        items_per_role_per_hour:
          type: integer
          nullable: true
          minimum: 0
        need_for_demand:
          type: boolean

    # Dashboard
    DashboardResponse:
      type: object
      properties:
        summary:
          type: object
          properties:
            total_employees:
              type: integer
            pending_requests:
              type: integer
            today_shifts:
              type: integer

    # Schedule
    ScheduleResponse:
      type: object
      properties:
        schedule:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              shifts:
                type: array
                items:
                  type: object
                  properties:
                    employee_id:
                      type: string
                      format: uuid
                    start_time:
                      type: string
                      format: date-time
                    end_time:
                      type: string
                      format: date-time

    UpdateScheduleRequest:
      type: object
      properties:
        shifts:
          type: array
          items:
            type: object
            properties:
              employee_id:
                type: string
                format: uuid
              date:
                type: string
                format: date
              start_time:
                type: string
              end_time:
                type: string

    EmployeeScheduleResponse:
      type: object
      properties:
        employee_id:
          type: string
          format: uuid
        shifts:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              start_time:
                type: string
                format: date-time
              end_time:
                type: string
                format: date-time

    UpdateEmployeeScheduleRequest:
      type: object
      properties:
        shifts:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              start_time:
                type: string
              end_time:
                type: string

    # Insights
    InsightsResponse:
      type: object
      properties:
        insights:
          type: object
          additionalProperties: true

    # Preferences
    PreferencesResponse:
      type: object
      properties:
        employee_id:
          type: string
          format: uuid
        preferred_hours:
          type: object
          additionalProperties: true
        availability:
          type: object
          additionalProperties: true

    UpdatePreferencesRequest:
      type: object
      properties:
        preferred_hours:
          type: object
          additionalProperties: true
        availability:
          type: object
          additionalProperties: true

    # Rules
    RulesResponse:
      type: object
      properties:
        organization_id:
          type: string
          format: uuid
        shift_max_hours:
          type: integer
          example: 10
        shift_min_hours:
          type: integer
          example: 4
        max_weekly_hours:
          type: integer
          example: 40
        min_weekly_hours:
          type: integer
          example: 20

    UpdateRulesRequest:
      type: object
      properties:
        shift_max_hours:
          type: integer
          minimum: 1
          example: 10
        shift_min_hours:
          type: integer
          minimum: 1
          example: 4
        max_weekly_hours:
          type: integer
          minimum: 1
          example: 40
        min_weekly_hours:
          type: integer
          minimum: 0
          example: 20
